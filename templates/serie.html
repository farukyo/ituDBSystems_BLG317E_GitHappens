{% extends "base.html" %}

{% block title %}{{ series.seriesTitle }} - BeeMD{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/movie.css') }}" />
<style>
    /* Movie.html'deki özel stillerin aynısı */
    .serie-detail-page { padding: 40px 0; }
    
    .header-section { margin-bottom: 30px; }
    .header-section h1 { color: #fff; font-size: 2rem; margin-bottom: 10px; margin-top: 0; }
    .header-section .meta-info { color: var(--accent); font-size: 1.1rem; margin-top: 10px; }

    .details-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
    }

    .section-title {
        color: #cfe6ff;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 25px;
    }

    .detail-item { display: flex; flex-direction: column; gap: 8px; }
    .detail-label { color: #cfe6ff; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .detail-value { color: #fff; font-size: 1.1rem; }
    .detail-value.highlight { color: var(--accent); font-weight: 600; }
    
    .col-runtime::before { content: ""; }
    .detail-grid .col-runtime::before { content: ""; }

    .genre-tags { display: flex; flex-wrap: wrap; gap: 8px; }
    .genre-tag {
        background: rgba(233, 96, 26, 0.2);
        color: var(--accent);
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    /* Cast Grid */
    .cast-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
    }
    .cast-item {
        display: flex; align-items: center; gap: 15px;
        background: rgba(255, 255, 255, 0.02);
        padding: 15px; border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: background 0.3s ease;
    }
    .cast-item:hover { background: rgba(255, 255, 255, 0.05); }
    .cast-avatar {
        width: 50px; height: 50px; border-radius: 50%;
        background: linear-gradient(135deg, var(--accent), #ff7a3d);
        display: flex; align-items: center; justify-content: center;
        color: #fff; font-weight: 600; font-size: 1.1rem; flex-shrink: 0;
    }
    .cast-info { flex: 1; min-width: 0; }
    .cast-name a { color: #fff; text-decoration: none; font-weight: 500; }
    .cast-name a:hover { color: var(--accent); }
    .cast-role { color: var(--muted); font-size: 0.85rem; }
    .cast-character { color: #7eb8ff; font-size: 0.85rem; font-style: italic; }

    /* Actions */
    .action-buttons { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px; }
    .btn-action {
        display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px;
        border-radius: 8px; font-weight: 500; text-decoration: none; transition: background 0.3s ease;
    }
    .btn-secondary { background: rgba(255, 255, 255, 0.08); color: #fff; }
    .btn-secondary:hover { background: rgba(255, 255, 255, 0.12); }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover { background: #d65a1a; }

    /* --- LIKE BUTONU STİLLERİ (EKLENDİ) --- */
    .like-btn {
        background: none;
        border: none;
        font-size: 2.5rem; /* Başlık boyutuna uygun büyük kalp */
        cursor: pointer;
        color: #555; /* Pasif renk */
        transition: transform 0.2s, color 0.2s;
        line-height: 1;
        padding: 0;
        margin-left: 15px; /* Başlıktan biraz uzaklaştır */
    }

    .like-btn:hover {
        transform: scale(1.1);
    }

    .like-btn.liked {
        color: #e50914; /* Aktif renk (Kırmızı) */
    }
</style>
{% endblock %}

{% block content %}
<div class="container serie-detail-page">

    <div class="header-section">
        <div style="display: flex; align-items: center;">
            <h1>{{ series.seriesTitle }}</h1>
            
            <button class="like-btn {{ 'liked' if series.is_liked else '' }}" 
                    data-id="{{ series.seriesId }}" 
                    data-type="series"
                    onclick="toggleEntityLike(this, event)">
                ❤
            </button>
        </div>

        <p class="meta-info">
            {{ series.titleType }} 
            {% if series.startYear %} • {{ series.startYear }} - {{ series.endYear or 'Present' }} {% endif %}
        </p>
    </div>

    <div class="details-card">
        <h3 class="section-title">Series Information</h3>
        <div class="detail-grid">

            <div class="detail-item">
                <span class="detail-label">Start Year</span>
                <span class="detail-value">
                    {{ series.startYear if series.startYear else 'N/A' }}
                </span>
            </div>

            <div class="detail-item">
                <span class="detail-label">Genres</span>
                <span class="detail-value">
                    {% if genres %}
                    <div class="genre-tags">
                        {% for genre in genres %}
                        <span class="genre-tag">{{ genre }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    N/A
                    {% endif %}
                </span>
            </div>

            <div class="detail-item">
                <span class="detail-label">Total Seasons</span>
                <span class="detail-value highlight">{{ stats.total_seasons or 0 }}</span>
            </div>

            <div class="detail-item">
                <span class="detail-label">Total Episodes</span>
                <span class="detail-value highlight">{{ stats.total_episodes or 0 }}</span>
            </div>

            <div class="detail-item">
                <span class="detail-label">Content Rating</span>
                <span class="detail-value">
                    {% if series.isAdult == 1 %} <span style="color:red">Adult</span> {% else %} General {% endif %}
                </span>
            </div>

            <div class="detail-item">
                <span class="detail-label">IMDb Rating</span>
                <span class="detail-value highlight">
                    {% if rating.rating %}
                        {{ rating.rating | float | round(1) }}/10
                    {% else %}
                        N/A
                    {% endif %}
                </span>
            </div>

            <div class="detail-item">
                <span class="detail-label">Votes</span>
                <span class="detail-value">
                    {% if rating.votes %}
                        {{ "{:,}".format(rating.votes) }}
                    {% else %}
                        N/A
                    {% endif %}
                </span>
            </div>

        </div>
    </div>

    <div class="details-card">
        <h3 class="section-title">Cast & Crew</h3>
        {% if cast %}
        <div class="cast-grid">
            {% for person in cast %}
            <div class="cast-item">
                <div class="cast-avatar">
                    {{ person.primaryName[0] if person.primaryName else '?' }}
                </div>
                <div class="cast-info">
                    <div class="cast-name">
                        <a href="/celebrities?q={{ person.primaryName }}">{{ person.primaryName }}</a>
                    </div>
                    <div class="cast-role">{{ person.category | title }}</div>
                    {% if person.characters and person.characters != '\\N' and person.characters != '0' and person.characters != '' %}
                    <div class="cast-character">as {{ person.characters }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color: var(--muted); font-style: italic;">No cast information available.</p>
        {% endif %}
    </div>

    <div class="action-buttons">
        <a href="{{ url_for('series.series') }}" class="btn-action btn-secondary">
            ← Back to Series List
        </a>
        
        <a href="{{ url_for('episode.episodes', seriesName=series.seriesTitle) }}" class="btn-action btn-primary">
            View All Episodes
        </a>
    </div>

</div>

<script>
    function toggleEntityLike(btn, event) {
        event.preventDefault();
        event.stopPropagation();

        const entityId = btn.getAttribute('data-id');
        const entityType = btn.getAttribute('data-type'); // 'series'

        let formData = new FormData();
        formData.append('entity_id', entityId);
        formData.append('entity_type', entityType);

        fetch('/like_entity', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            if (data === "1") {
                if (btn.classList.contains('liked')) {
                    btn.classList.remove('liked');
                } else {
                    btn.classList.add('liked');
                }
            } else {
                alert("Login required or error occurred.");
            }
        })
        .catch(err => console.error('Error:', err));
    }
</script>
{% endblock %}