{% extends "base.html" %}

{% block title %}{{ title | default("Movies") }} - BeeMD{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/movies.css') }}" />
{% endblock %}

{% block content %}
<div class="episodes-page">
    <div class="container">
        <h1>{{ title | default("All Movies") }}</h1>
        <p class="sub-title">Browse and filter the complete movie database</p>

        <form action="{{ url_for('movie.movies') }}" method="GET" class="search-form">
            <div class="filter-grid">

                <div class="filter-group">
                    <label>Movie Title</label>
                    <input type="text" name="title" placeholder="Search title..."
                        value="{{ request.args.get('title', '') }}">
                </div>

                <div class="filter-group">
                    <label>Genre</label>
                    <select name="genre">
                        <option value="">All Genres</option>
                        {% if genres %}
                        {% for g in genres %}
                        <option value="{{ g }}" {% if request.args.get('genre')==g %}selected{% endif %}>
                            {{ g }}
                        </option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <div class="filter-group">
                    <label>Release Year</label>
                    <input type="number" name="year" placeholder="e.g. 2023" value="{{ request.args.get('year', '') }}">
                </div>

                <div class="filter-group">
                    <label>IMDb Rating</label>
                    <div class="range-inputs">
                        <input type="number" step="0.1" name="min_rating" placeholder="0"
                            value="{{ request.args.get('min_rating', '') }}">
                        <span>-</span>
                        <input type="number" step="0.1" name="max_rating" placeholder="10"
                            value="{{ request.args.get('max_rating', '') }}">
                    </div>
                </div>

                <div class="filter-group" style="justify-content: flex-end;">
                    <div class="filter-buttons">
                        <button type="submit">Search</button>
                        <a href="{{ url_for('movie.movies') }}" class="btn-reset">Reset</a>
                    </div>
                </div>
            </div>
        </form>
        <div class="movie-actions" style="margin-bottom:20px;">
            <a href="{{ url_for('movie.movies') }}?{{ request.query_string|safe }}&view=stats" class="btn-primary">
                üìä Detailed Movie Stats
            </a>
        </div>

        <hr>




        <div class="episode-list">
            {% if movies %}
            
            {% if request.args.get('view') == 'stats' %}
            <div class="episode-table-header movie-grid-layout">
                <div>TITLE</div>
                <div>YEAR</div>
                <div>RATING</div>
                <div>CAST COUNT</div> <div>GENRE COUNT</div> <div style="text-align: center;">LIKE</div>
            </div>
            {% else %}
            <div class="episode-table-header movie-grid-layout">
                <div>TITLE</div>
                <div>YEAR</div>
                <div>RATING</div>
                <div>GENRE</div>
                <div>RUNTIME</div>
                <div style="text-align: center;">LIKE</div>
            </div>
            {% endif %}

            {% for movie in movies %}
            <div class="episode-item movie-grid-layout">

                <div class="col-title">
                    <a href="{{ url_for('movie.movie', movie_id=movie.movieId) }}" class="episode-title-link">
                        {{ movie.movieTitle }}
                    </a>
                </div>

                <div class="col-year">
                    <span style="color: #fff;">{{ movie.startYear }}</span>
                </div>

                <div class="col-rating">
                    {% if movie.averageRating %}
                    <span style="color: #f5c518; font-weight: bold;">‚òÖ {{ movie.averageRating }}</span>
                    {% else %}
                    <span style="color: #666;">-</span>
                    {% endif %}
                </div>

                {% if request.args.get('view') == 'stats' %}
                    <div class="col-runtime" style="color:#aaa;">{{ movie.cast_count }} Actors</div>
                    <div class="col-genre">
                        <div class="genre-tags">
                            {% for genre in (movie.genre_str.split(', ') if movie.genre_str else []) %}
                                <span class="genre-tag">{{ genre }}</span>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="col-genre">
                        <span style="color: #7eb8ff; font-size: 0.9em;">
                            {{ movie.genre_str if movie.genre_str else '-' }}
                        </span>
                    </div>
                    <div class="col-runtime">
                        {% if movie.runtimeMinutes %}
                        {{ movie.runtimeMinutes }} min
                        {% else %}
                        -
                        {% endif %}
                    </div>
                {% endif %}

                <div style="text-align: center;">
                    <button class="like-btn {{ 'liked' if movie.is_liked else '' }}" 
                            data-id="{{ movie.movieId }}" 
                            data-type="movie"
                            onclick="toggleEntityLike(this, event)">
                        ‚ù§
                    </button>
                </div>

            </div>
            {% endfor %}

            {% else %}
            <div class="no-results">
                <p>No movies found matching your criteria.</p>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}