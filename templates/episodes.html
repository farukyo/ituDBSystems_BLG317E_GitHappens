{% extends "base.html" %}

{% block title %}{{ title | default("Episodes") }} - BeeMD{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/episodes.css') }}">
{% endblock %}

{% block content %}
<div class="container episodes-page">

    <h1>TV Episodes</h1>

    <form action="{{ url_for('episodes') }}" method="get" id="episode-filter-form">

        <!-- Filter Grid -->
        <div class="filter-grid">

            <!-- Episode ID -->
            <div class="filter-group">
                <label for="episodeId">Episode ID</label>
                <input type="text" id="episodeId" name="episodeId" placeholder="e.g. tt1234567"
                    value="{{ request.args.get('episodeId') or '' }}">
            </div>

            <!-- Episode Title -->
            <div class="filter-group">
                <label for="epTitle">Episode Title</label>
                <input type="text" id="epTitle" name="epTitle" placeholder="Search title..."
                    value="{{ request.args.get('epTitle') or '' }}">
            </div>

            <!-- Runtime Range -->
            <div class="filter-group">
                <label for="runtimeMin">Runtime (min)</label>
                <div class="range-inputs">
                    <input type="number" id="runtimeMin" name="runtimeMin" placeholder="Min" min="0"
                        value="{{ request.args.get('runtimeMin') or '' }}">
                    <span>-</span>
                    <input type="number" id="runtimeMax" name="runtimeMax" placeholder="Max" min="0"
                        value="{{ request.args.get('runtimeMax') or '' }}">
                </div>
            </div>

            <!-- Series ID -->
            <div class="filter-group">
                <label for="seriesId">Series ID</label>
                <input type="text" id="seriesId" name="seriesId" placeholder="e.g. tt0944947"
                    value="{{ request.args.get('seriesId') or '' }}">
            </div>

            <!-- Season Number -->
            <div class="filter-group">
                <label for="seNumber">Season Number</label>
                <input type="number" id="seNumber" name="seNumber" placeholder="Season" min="1"
                    value="{{ request.args.get('seNumber') or '' }}">
            </div>

            <!-- Episode Number -->
            <div class="filter-group">
                <label for="epNumber">Episode Number</label>
                <input type="number" id="epNumber" name="epNumber" placeholder="Episode" min="1"
                    value="{{ request.args.get('epNumber') or '' }}">
            </div>

        </div>

        <!-- Buttons -->
        <div class="filter-buttons">
            <button type="submit" id="episode-filter-btn">Search</button>
            <a href="{{ url_for('episodes') }}" class="btn-reset">Reset Filters</a>
        </div>

    </form>

    <hr>

    <h2 class="sub-title">Results ({{ items|length if items else 0 }} episodes)</h2>

    <div class="episode-list">
        {% if items %}

        <!-- Table Header -->
        <div class="episode-table-header">
            <span class="col-id">Episode ID</span>
            <span class="col-title">Title</span>
            <span class="col-runtime">Runtime</span>
            <span class="col-series">Series</span>
            <span class="col-season">Season</span>
            <span class="col-episode">Episode</span>
        </div>

        {% for episode in items %}
        <div class="episode-item">
            <span class="col-id episode-id">{{ episode.episodeId }}</span>
            <span class="col-title">
                <a href="/episode/{{ episode.episodeId }}" class="episode-title-link">
                    {{ episode.primaryTitle or 'Untitled' }}
                </a>
            </span>
            <span class="col-runtime">
                {% if episode.runtimeMinutes %}
                {{ episode.runtimeMinutes }} min
                {% else %}
                N/A
                {% endif %}
            </span>
            <span class="col-series">
                {% if episode.seriesId %}
                <a href="/serie/{{ episode.seriesId }}" class="series-link">
                    {{ episode.seriesTitle or episode.seriesId }}
                </a>
                {% else %}
                N/A
                {% endif %}
            </span>
            <span class="col-season">
                {% if episode.seasonNumber %}
                S{{ episode.seasonNumber }}
                {% else %}
                -
                {% endif %}
            </span>
            <span class="col-episode">
                {% if episode.episodeNumber %}
                E{{ episode.episodeNumber }}
                {% else %}
                -
                {% endif %}
            </span>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-results">
            {% if request.args.get('epTitle') or request.args.get('episodeId') or request.args.get('seriesId') or
            request.args.get('seNumber') or request.args.get('epNumber') %}
            <p>No episodes found matching your criteria.</p>
            <p class="hint">Try adjusting your filters or use fewer search terms.</p>
            {% else %}
            <p>Use the filters above to search for episodes.</p>
            <p class="hint">You can filter by Episode ID, Title, Runtime, Series ID, Season, or Episode number.</p>
            {% endif %}
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/episodes.js') }}"></script>
{% endblock %}