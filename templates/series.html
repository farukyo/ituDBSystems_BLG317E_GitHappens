{% extends "base.html" %}

{% block title %}Series - BeeMD{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/series.css') }}">
{% endblock %}

{% block content %}
<div class="episodes-page">
    <div class="container">

        <h1>{{ title | default("All Series") }}</h1>
        <p class="sub-title">Browse and filter the complete TV series database</p>

        <!-- SEARCH / FILTERS -->
        <form action="{{ url_for('series') }}" method="GET">

            <!-- search-box -->
            <div class="search-box">
                <input type="text" id="series-search" name="q" placeholder="Search series..."
                       value="{{ request.args.get('q', '') }}">
                <button id="series-search-btn" type="submit">Search</button>
            </div>

            <!-- filters -->
            <div class="filters">

                <select name="genre">
                    <option value="">All Genres</option>
                    {% if genres %}
                        {% for g in genres %}
                            <option value="{{ g }}"
                                {% if request.args.get('genre') == g %}selected{% endif %}>
                                {{ g }}
                            </option>
                        {% endfor %}
                    {% endif %}
                </select>

                <input type="number" name="startYear" placeholder="Start Year"
                       value="{{ request.args.get('startYear', '') }}">

                <input type="number" step="0.1" name="min_rating" placeholder="Min IMDb"
                       value="{{ request.args.get('min_rating', '') }}">

                <input type="number" step="0.1" name="max_rating" placeholder="Max IMDb"
                       value="{{ request.args.get('max_rating', '') }}">

                <button id="filter-btn" type="submit">Apply</button>
            </div>
        </form>

        <hr>

        <!-- SERIES LIST -->
        <div class="series-list">

            {% if items %}
                {% for row in items %}
                    <div class="series-item">

                        <div class="series-title">
                            <a href="{{ url_for('serie_detail', series_id=row.seriesId) }}">
                                {{ row.seriesTitle }}
                            </a>

                            {% if row.isAdult == 1 %}
                                <span style="color:red; font-size:0.7em;
                                border:1px solid red; padding:0 4px;
                                border-radius:3px; margin-left:6px;">
                                    18+
                                </span>
                            {% endif %}
                        </div>

                        <div class="series-meta">
                            {{ row.startYear }} – {{ row.endYear if row.endYear else '?' }}
                            &nbsp;•&nbsp;
                            IMDb:
                            {% if row.averageRating %}
                                {{ row.averageRating }}
                            {% else %}
                                -
                            {% endif %}
                            &nbsp;•&nbsp;
                            {{ row.genre_str if row.genre_str else 'Unknown' }}
                            &nbsp;•&nbsp;
                            {% if row.runtimeMinutes %}
                                {{ row.runtimeMinutes }} min
                            {% else %}
                                Runtime N/A
                            {% endif %}
                        </div>

                    </div>
                {% endfor %}
            {% else %}
                <div class="no-results">
                    No series found.
                </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}
