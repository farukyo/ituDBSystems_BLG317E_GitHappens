{% extends "base.html" %}

{% block title %}Series - BeeMD{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/series.css') }}">
{% endblock %}

{% block content %}
<div class="episodes-page"> <div class="container">
        
        <h1>{{ title | default("All Series") }}</h1>
        <p class="sub-title">Browse and filter the complete TV series database</p>

        <form action="{{ url_for('series') }}" method="GET" class="search-form">
            <div class="filter-grid">
                
                <div class="filter-group">
                    <label>Series Title</label>
                    <input type="text" name="title" placeholder="Search series..." 
                           value="{{ request.args.get('title', '') }}">
                </div>

                <div class="filter-group">
                    <label>Genre</label>
                    <select name="genre">
                        <option value="">All Genres</option>
                        {% if genres %}
                            {% for g in genres %}
                            <option value="{{ g }}" {% if request.args.get('genre')==g %}selected{% endif %}>
                                {{ g }}
                            </option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <div class="filter-group">
                    <label>Start Year</label>
                    <input type="number" name="startYear" placeholder="e.g. 2023" 
                           value="{{ request.args.get('startYear', '') }}">
                </div>

                <div class="filter-group">
                    <label>IMDb Rating</label>
                    <div class="range-inputs">
                        <input type="number" step="0.1" name="min_rating" placeholder="0" 
                               value="{{ request.args.get('min_rating', '') }}">
                        <span>-</span>
                        <input type="number" step="0.1" name="max_rating" placeholder="10" 
                               value="{{ request.args.get('max_rating', '') }}">
                    </div>
                </div>

                <div class="filter-group" style="justify-content: flex-end;">
                    <div class="filter-buttons">
                        <button type="submit">Search</button>
                        <a href="{{ url_for('series') }}" class="btn-reset">Reset</a>
                    </div>
                </div>
            </div>
        </form>

        <hr>

        <div class="episode-table-header movie-grid-layout">
            <div class="col-title">TITLE</div>
            <div class="col-year">YEARS</div>
            <div class="col-rating">IMDB</div>
            <div class="col-genre">GENRE</div>
            <div class="col-runtime">RUNTIME</div>
        </div>

        <div class="episode-list">
            {% if items %}
                {% for row in items %}
                <div class="episode-item movie-grid-layout">
                    
                    <div class="col-title">
                        <a href="{{ url_for('serie_detail', series_id=row.seriesId) }}" class="episode-title-link">
                            {{ row.seriesTitle }}
                        </a>
                        {% if row.isAdult == 1 %}
                            <span style="color:red; font-size:0.7em; border:1px solid red; padding:0 2px; border-radius:3px; margin-left:5px;">18+</span>
                        {% endif %}
                    </div>

                    <div class="col-year">
                        <span>
                            {{ row.startYear }} - {{ row.endYear if row.endYear else '?' }}
                        </span>
                    </div>

                    <div class="col-rating">
                        {% if row.averageRating %}
                            <span style="color: #f5c518; font-weight: bold;">â˜… {{ row.averageRating }}</span>
                        {% else %}
                            <span style="color: #666;">-</span>
                        {% endif %}
                    </div>

                    <div class="col-genre">
                        <span style="color: #7eb8ff; font-size: 0.9em;">
                            {{ row.genre_str if row.genre_str else '-' }}
                        </span>
                    </div>

                    <div class="col-runtime">
                        {% if row.runtimeMinutes %}
                            {{ row.runtimeMinutes }} min
                        {% else %}
                            -
                        {% endif %}
                    </div>

                </div>
                {% endfor %}
            
            {% else %}
                <div class="