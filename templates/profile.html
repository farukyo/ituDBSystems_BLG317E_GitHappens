{% extends "base.html" %}

{% block title %}{{ user.username }}'s Profile{% endblock %}

{% block head %}
    <style>
        .profile-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #1f1f1f;
            border-radius: 12px;
            border: 1px solid #333;
            color: #fff;
        }
        .profile-header {
            border-bottom: 2px solid #d65a1a;
            padding-bottom: 1.5rem;
            margin-bottom: 2.5rem;
        }
        .profile-header h1 {
            margin: 0;
            color: #d65a1a;
            font-size: 2.5rem;
        }
        .profile-header p {
            font-size: 1.1rem;
            color: #aaa;
            margin-top: 0.5rem;
        }
        .profile-info {
            display: flex;
            gap: 3rem;
            margin-top: 1.5rem;
        }
        .profile-info-item {
            color: #ccc;
            font-size: 1.1rem;
        }
        .profile-info-item span {
            font-weight: bold;
            color: #fff;
            margin-left: 5px;
        }
        
        /* Profil Bölüm Başlıkları */
        .section-header {
            margin-top: 40px; 
            margin-bottom: 20px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            padding-bottom: 10px;
        }
        .section-header h2 {
            color: #d65a1a;
            font-size: 1.8rem;
            margin: 0;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        /* --- KART TASARIMI GÜNCELLENDİ (Tıklanabilir Alan) --- */
        .card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.2s, background 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            
            /* Önemli: Linkin yayılması için referans noktası */
            position: relative; 
        }
        
        .card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.08);
            border-color: #d65a1a;
            cursor: pointer;
        }

        .card h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            line-height: 1.4;
        }

        .card h3 a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
        }
        
        /* Kartın ana linkini (başlık) görünmez bir perde gibi tüm karta yayıyoruz */
        .card h3 a::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .card h3 a:hover {
            color: #d65a1a;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        .rating-star {
            color: #d65a1a;
        }

        /* Episode kartındaki 'Dizi Adı' linki */
        .sub-text {
            font-size: 0.85rem;
            color: #f5c518;
            margin-bottom: 5px;
            font-weight: bold;
            
            /* Bu linkin öne çıkması ve ayrı tıklanabilmesi için */
            position: relative;
            z-index: 2; 
        }
        
        .sub-text a:hover {
            text-decoration: underline;
        }
        
        /* Quiz Skoru */
        .quiz-score-box {
            background: rgba(245, 197, 24, 0.1);
            border: 1px solid #d65a1a;
            padding: 15px;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 20px;
        }
        .quiz-score-box h3 {
            margin: 0;
            color: #d65a1a;
        }
    </style>
{% endblock %}


{% block content %}
<div class="profile-container">
    
    <div class="profile-header">
        <h1>{{ user.username }}</h1>
        <p>Email: {{ user.email }}</p>

        <div class="profile-info">
            <div class="profile-info-item">
                Date of Birth: 
                <span>
                    {% if user.dob %}
                        {{ user.dob.strftime('%d.%m.%Y') }}
                    {% else %}
                        N/A
                    {% endif %}
                </span>
            </div>
            <div class="profile-info-item">
                Gender: <span>{{ user.gender | title | default('N/A') }}</span>
            </div>
        </div>
    </div>

    <div class="profile-section">
        <div class="quiz-score-box">
            <span>My Quiz Score:</span>
            <h3>{{ user.score | default(0) }}</h3>
        </div>
    </div>

    {% if liked_movies %}
    <div class="section-header">
        <h2>Liked Movies</h2>
    </div>
    <div class="grid-container">
        {% for movie in liked_movies %}
        <div class="card">
            <h3>
                <a href="{{ url_for('movie.movie', movie_id=movie.movieId) }}">
                    {{ movie.movieTitle }}
                </a>
            </h3>
            <div class="card-meta">
                <span>{{ movie.startYear }}</span>
                {% if movie.averageRating %}
                <span><span class="rating-star">★</span> {{ movie.averageRating }}</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if liked_series %}
    <div class="section-header">
        <h2>Liked Series</h2>
    </div>
    <div class="grid-container">
        {% for serie in liked_series %}
        <div class="card">
            <h3>
                <a href="{{ url_for('series.serie_detail', series_id=serie.seriesId) }}">
                    {{ serie.seriesTitle }}
                </a>
            </h3>
            <div class="card-meta">
                <span>
                    {{ serie.startYear }} 
                    {% if serie.endYear %} - {{ serie.endYear }} {% else %} - Present {% endif %}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if liked_episodes %}
    <div class="section-header">
        <h2>Liked Episodes</h2>
    </div>
    <div class="grid-container">
        {% for ep in liked_episodes %}
        <div class="card">
            <div class="sub-text">
                <a href="{{ url_for('series.serie_detail', series_id=ep.seriesId) }}" style="color: inherit; font-weight: normal;">
                    {{ ep.seriesTitle }}
                </a>
            </div>
            <h3>
                <a href="{{ url_for('episode.episode_detail', episode_id=ep.episodeId) }}">
                    {{ ep.epTitle or 'Untitled Episode' }}
                </a>
            </h3>
            <div class="card-meta">
                <span>S{{ ep.seNumber }} • E{{ ep.epNumber }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if liked_celebs %}
    <div class="section-header">
        <h2>Liked Celebrities</h2>
    </div>
    <div class="grid-container">
        {% for celeb in liked_celebs %}
        <div class="card">
            <h3>
                <a href="{{ url_for('celebrity.celebrity_detail', people_id=celeb.peopleId) }}">
                    {{ celeb.primaryName }}
                </a>
            </h3>
            <div class="card-meta">
                <span>
                    {% if celeb.birthYear %}
                        {{ celeb.birthYear }}
                        {% if celeb.deathYear %} - {{ celeb.deathYear }}{% endif %}
                    {% else %}
                        -
                    {% endif %}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if not liked_movies and not liked_series and not liked_episodes and not liked_celebs %}
    <div style="text-align: center; color: #777; margin-top: 50px;">
        <p>You haven't liked any items yet.</p>
        <p>Go explore movies, series, and celebrities!</p>
    </div>
    {% endif %}

</div>
{% endblock %}